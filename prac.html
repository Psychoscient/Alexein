<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library Management System</title>

    <!-- BOOTSTRAP -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
        body { background: #eef1f7; }
        .hidden { display: none; }
        header {
            background: #3949ab;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 24px;
        }
        .container-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<header>Library Management System</header>

<!-- LOGIN PAGE -->
<div class="container mt-4" id="authPage">
    <div class="container-box col-md-6 mx-auto">
        <h2>Login</h2>
        <input id="loginUser" class="form-control mt-2" placeholder="Username" />
        <input id="loginPass" class="form-control mt-2" placeholder="Password" type="password" />
        <button class="btn btn-primary w-100 mt-3" onclick="login()">Login</button>
        <hr>
        <button class="btn btn-secondary w-100" onclick="showSignup()">Sign Up</button>
    </div>
</div>

<!-- SIGNUP PAGE -->
<div class="container mt-4 hidden" id="signupPage">
    <div class="container-box col-md-6 mx-auto">
        <h2>Sign Up</h2>
        <input id="newUser" class="form-control mt-2" placeholder="Create Username" />
        <input id="newPass" class="form-control mt-2" placeholder="Create Password" type="password" />
        <button class="btn btn-success w-100 mt-3" onclick="signup()">Create Account</button>
        <button class="btn btn-secondary w-100 mt-2" onclick="showLogin()">Back to Login</button>
    </div>
</div>

<!-- USER PAGE -->
<div class="container mt-4 hidden" id="userPage">
    <div class="container-box">
        <h2>User Dashboard</h2>
        <button class="btn btn-danger mb-3" onclick="logout()">Logout</button>

        <h3>Available Books</h3>
        <table class="table table-bordered" id="userBookTable"></table>

        <h3>Your Borrowed Books</h3>
        <table class="table table-bordered" id="userBorrowed"></table>
    </div>
</div>

<!-- LIBRARIAN PAGE -->
<div class="container mt-4 hidden" id="librarianPage">
    <div class="container-box">
        <h2>Librarian Dashboard</h2>
        <button class="btn btn-danger mb-3" onclick="logout()">Logout</button>

        <h3>Add New Book</h3>
        <input id="bTitle" class="form-control mt-2" placeholder="Book Title" />
        <input id="bAuthor" class="form-control mt-2" placeholder="Author" />
        <input id="bGenre" class="form-control mt-2" placeholder="Genre" />
        <input id="bCopies" class="form-control mt-2" placeholder="Copies" type="number" />
        <button class="btn btn-primary w-100 mt-3" onclick="addBook()">Add Book</button>

        <h3 class="mt-4">Books Inventory</h3>
        <table class="table table-bordered" id="bookTable"></table>

        <h3>Registered Users</h3>
        <table class="table table-bordered" id="userTable"></table>
    </div>
</div>

<script>
/* STORAGE HELPERS */
function save(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
function load(key, fallback) { return JSON.parse(localStorage.getItem(key)) || fallback; }

/* DATA */
let books = load("books", [
    {title:"Harry Potter", author:"J.K. Rowling", genre:"Fantasy", copies:5},
    {title:"The Hobbit", author:"J.R.R. Tolkien", genre:"Fantasy", copies:3}
]);
let users = load("users", [
    {username:"Librarian", password:"CICS", type:"librarian"}
]);
let borrowRecords = load("borrowRecords", []);
let loggedUser = null;

/* AUTH */
function signup(){
    users.push({ username:newUser.value, password:newPass.value, type:"user" });
    save("users", users);
    alert("Account created.");
    showLogin();
}

function login(){
    let u = loginUser.value, p = loginPass.value;
    let found = users.find(x => x.username===u && x.password===p);
    if(!found) return alert("Invalid credentials.");

    loggedUser = found;
    authPage.classList.add("hidden");

    found.type === "librarian" ? showLibrarian() : showUser();
}

function logout(){ location.reload(); }

/* LIBRARIAN FUNCTIONS */
function addBook(){
    books.push({
        title:bTitle.value, author:bAuthor.value,
        genre:bGenre.value, copies:Number(bCopies.value)
    });

    save("books", books);
    renderBooks();
}

function deleteBook(i){
    if(!confirm("Delete this book?")) return;
    books.splice(i,1);
    save("books", books);
    renderBooks();
}

function updateBook(i){
    let b = books[i];
    let title = prompt("New Title:", b.title);
    let author = prompt("New Author:", b.author);
    let genre = prompt("New Genre:", b.genre);
    let copies = prompt("New Copies:", b.copies);

    books[i] = { title, author, genre, copies:Number(copies) };
    save("books", books);
    renderBooks();
}

function renderBooks(){
    let html = `<tr>
        <th>Title</th><th>Author</th><th>Genre</th><th>Copies</th><th>Actions</th>
    </tr>`;

    books.forEach((b,i)=>{
        html += `
        <tr>
            <td>${b.title}</td>
            <td>${b.author}</td>
            <td>${b.genre}</td>
            <td>${b.copies}</td>
            <td>
                <button class="btn btn-warning btn-sm" onclick="updateBook(${i})">Update</button>
                <button class="btn btn-danger btn-sm" onclick="deleteBook(${i})">Delete</button>
            </td>
        </tr>`;
    });

    bookTable.innerHTML = html;
}

function renderUsers(){
    let html = `<tr><th>Username</th></tr>`;
    users.filter(x=>x.type==="user").forEach(u=>{
        html += `<tr><td>${u.username}</td></tr>`;
    });
    userTable.innerHTML = html;
}

/* USER FUNCTIONS */
function renderUserBooks(){
    let html = `<tr>
        <th>Title</th><th>Author</th><th>Genre</th><th>Copies</th><th>Borrow</th>
    </tr>`;

    books.forEach((b,i)=>{
        html += `
        <tr>
            <td>${b.title}</td>
            <td>${b.author}</td>
            <td>${b.genre}</td>
            <td>${b.copies}</td>
            <td><button class="btn btn-primary btn-sm" onclick="borrow(${i})">Borrow</button></td>
        </tr>`;
    });

    userBookTable.innerHTML = html;
}

function borrow(i){
    if(books[i].copies < 1) return alert("No copies left.");

    books[i].copies--;
    save("books", books);

    borrowRecords.push({
        user:loggedUser.username,
        book:books[i].title
    });
    save("borrowRecords", borrowRecords);

    renderUserBooks();
    renderUserBorrow();
}

function returnBook(title){
    let recIndex = borrowRecords.findIndex(x => x.user===loggedUser.username && x.book===title);

    if(recIndex !== -1){
        borrowRecords.splice(recIndex, 1);
        save("borrowRecords", borrowRecords);

        let book = books.find(b => b.title === title);
        if(book){
            book.copies++;
            save("books", books);
        }

        renderUserBooks();
        renderUserBorrow();
    }
}

function renderUserBorrow(){
    let html = `<tr><th>Book</th><th>Return</th></tr>`;

    borrowRecords.filter(x=>x.user===loggedUser.username).forEach(r=>{
        html += `
        <tr>
            <td>${r.book}</td>
            <td><button class="btn btn-success btn-sm" onclick="returnBook('${r.book}')">Return</button></td>
        </tr>`;
    });

    userBorrowed.innerHTML = html;
}

/* PAGE SWITCHING */
function showSignup(){ authPage.classList.add("hidden"); signupPage.classList.remove("hidden"); }
function showLogin(){ signupPage.classList.add("hidden"); authPage.classList.remove("hidden"); }
function showLibrarian(){ librarianPage.classList.remove("hidden"); renderBooks(); renderUsers(); }
function showUser(){ userPage.classList.remove("hidden"); renderUserBooks(); renderUserBorrow(); }

</script>

</body>
</html>